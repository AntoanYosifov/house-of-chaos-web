<div class="profile-wrapper">
  <div class="profile-decoration">
    <span class="decoration-circle decoration-circle-1"></span>
    <span class="decoration-circle decoration-circle-2"></span>
    <span class="decoration-circle decoration-circle-3"></span>
    <span class="decoration-circle decoration-circle-4"></span>
    <span class="decoration-circle decoration-circle-5"></span>
  </div>

  <div class="profile-container animate-in">
    <div class="profile-header">
      <div class="logo">
        <h1>House of Chaos</h1>
        <span class="logo-accent">Collect the extraordinary</span>
      </div>
    </div>

    @if (loading) {
      <section class="profile-card">
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p class="loading-text">Loading your profile...</p>
        </div>
      </section>
    } @else if (profile) {
      <section class="profile-card">
        <div class="profile-card-header">
          <div class="avatar" aria-hidden="true">
            <span>
              {{ (profile.firstName || '')?.[0] || (profile.email || '')?.[0] || 'U' }}
            </span>
          </div>
          <div class="identity">
            <h2 class="title">
              @if (profile.firstName || profile.lastName) {
                {{ profile.firstName }} {{ profile.lastName }}
              } @else {
                {{ profile.email }}
              }
            </h2>
            <p class="subtitle">{{ profile.email }}</p>
          </div>
          <div class="status">
            @if (profile.firstName && profile.lastName && profile.address) {
              <span class="badge badge-success">Profile complete</span>
            } @else {
              <span class="badge badge-warn">Profile incomplete</span>
            }
          </div>
        </div>

        <div class="profile-sections">
          <div class="profile-section">
            <h3>Account</h3>
            <div class="info-grid">
              <div class="info-item">
                <span class="label">Email</span>
                <span class="value">{{ profile.email }}</span>
              </div>
              <div class="info-item">
                <span class="label">Created</span>
                <span class="value">{{ profile.createdOn | date: 'medium' }}</span>
              </div>
              <div class="info-item">
                <span class="label">Updated</span>
                <span class="value">{{ profile.updatedAt | date: 'medium'}}</span>
              </div>
            </div>
          </div>

          <div class="profile-section">
            <h3>Profile</h3>
            
            @if (!isProfileComplete) {
              <div class="profile-info-message">
                <div class="info-icon">
                  <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                  </svg>
                </div>
                <div class="info-content">
                  <h4 class="info-title">Complete Your Profile</h4>
                  <p class="info-text">
                    Ordering requires an address we can ship to. Add your full name and address so you can reuse it instantly whenever you place an order.
                  </p>
                </div>
              </div>
            }

            <div class="profile-content-wrapper">
              <div class="profile-view" [class.hidden]="isEditMode">
                <div class="personal-info-section">
                  <div class="info-grid">
                    <div class="info-item">
                      <span class="label">First name</span>
                      <span class="value muted">
                        {{ profile.firstName || '—' }}
                      </span>
                    </div>
                    <div class="info-item">
                      <span class="label">Last name</span>
                      <span class="value muted">
                        {{ profile.lastName || '—' }}
                      </span>
                    </div>
                  </div>
                </div>

                <div class="address-section">
                  <h4 class="address-header">Address</h4>
                  <div class="info-grid">
                    <div class="info-item">
                      <span class="label">Country</span>
                      <span class="value muted">
                        {{ profile.address?.country || '—' }}
                      </span>
                    </div>
                    <div class="info-item">
                      <span class="label">City</span>
                      <span class="value muted">
                        {{ profile.address?.city || '—' }}
                      </span>
                    </div>
                    <div class="info-item">
                      <span class="label">Zip</span>
                      <span class="value muted">
                        {{ profile.address?.zip || '—' }}
                      </span>
                    </div>
                    <div class="info-item info-item--full">
                      <span class="label">Street</span>
                      <span class="value muted">
                        {{ profile.address?.street || '—' }}
                      </span>
                    </div>
                  </div>
                </div>

                <div class="profile-actions">
                  <button type="button" class="btn btn-primary" (click)="onEdit()">
                    {{ isProfileComplete ? 'Edit Profile' : 'Complete Profile' }}
                  </button>
                </div>
              </div>

              <div class="profile-form-wrapper" [class.hidden]="!isEditMode">
                <form [formGroup]="personalInfoForm" (ngSubmit)="onSave()" class="profile-form">
                  <div class="personal-info-section">
                    <div class="form-grid">
                      <div class="form-column">
                        <div class="form-group">
                          <label for="firstName" class="form-label">First Name</label>
                          <input
                            type="text"
                            id="firstName"
                            class="form-input"
                            [class.error]="isFirstNameNotValid"
                            placeholder="Enter your first name"
                            formControlName="firstName"
                          />
                          @if (isFirstNameNotValid) {
                            <div class="error-message">
                              <span>{{ firstNameErrorMessage }}</span>
                            </div>
                          }
                        </div>

                        <div class="form-group">
                          <label for="lastName" class="form-label">Last Name</label>
                          <input
                            type="text"
                            id="lastName"
                            class="form-input"
                            [class.error]="isLastNameNotValid"
                            placeholder="Enter your last name"
                            formControlName="lastName"
                          />
                          @if (isLastNameNotValid) {
                            <div class="error-message">
                              <span>{{ lastNameErrorMessage }}</span>
                            </div>
                          }
                        </div>
                      </div>

                      <div class="form-column">
                      </div>
                    </div>
                  </div>

                  <div class="address-section">
                    <h4 class="address-header">Address</h4>
                    <div formGroupName="address" class="address-group">
                      <div class="form-grid">
                        <div class="form-column">
                          <div class="form-group">
                            <label for="country" class="form-label">Country</label>
                            <input
                              type="text"
                              id="country"
                              class="form-input"
                              [class.error]="isCountryNotValid"
                              placeholder="Enter your country"
                              formControlName="country"
                            />
                            @if (isCountryNotValid) {
                              <div class="error-message">
                                <span>{{ countryErrorMessage }}</span>
                              </div>
                            }
                          </div>

                          <div class="form-group">
                            <label for="city" class="form-label">City</label>
                            <input
                              type="text"
                              id="city"
                              class="form-input"
                              [class.error]="isCityNotValid"
                              placeholder="Enter your city"
                              formControlName="city"
                            />
                            @if (isCityNotValid) {
                              <div class="error-message">
                                <span>{{ cityErrorMessage }}</span>
                              </div>
                            }
                          </div>
                        </div>

                        <div class="form-column">
                          <div class="form-group">
                            <label for="zip" class="form-label">Zip Code</label>
                            <input
                              type="text"
                              id="zip"
                              class="form-input"
                              [class.error]="isZipNotValid"
                              placeholder="Enter your zip code"
                              formControlName="zip"
                            />
                            @if (isZipNotValid) {
                              <div class="error-message">
                                <span>{{ zipErrorMessage }}</span>
                              </div>
                            }
                          </div>

                          <div class="form-group">
                            <label for="street" class="form-label">Street</label>
                            <input
                              type="text"
                              id="street"
                              class="form-input"
                              [class.error]="isStreetNotValid"
                              placeholder="Enter your street address"
                              formControlName="street"
                            />
                            @if (isStreetNotValid) {
                              <div class="error-message">
                                <span>{{ streetErrorMessage }}</span>
                              </div>
                            }
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-actions">
                    <button
                      type="submit"
                      class="btn btn-primary"
                      [disabled]="personalInfoForm.invalid">
                      Save Changes
                    </button>
                    <button
                      type="button"
                      class="btn btn-secondary"
                      (click)="onCancel()">
                      Cancel
                    </button>
                  </div>
                </form>
              </div>

              @if (showSuccessBanner) {
                <div class="success-banner" [class.fade-out]="isHidingBanner">
                  <div class="success-icon">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  </div>
                  <div class="success-content">
                    <h4 class="success-title">Profile Completed Successfully!</h4>
                    <p class="success-text">Your profile has been completed. You can now order products and write reviews.</p>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      </section>
    }
  </div>
</div>
