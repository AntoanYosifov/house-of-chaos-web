<div class="product-details-wrapper">
    <div class="product-details-decoration">
        <div class="decoration-circle decoration-circle-1"></div>
        <div class="decoration-circle decoration-circle-2"></div>
        <div class="decoration-circle decoration-circle-3"></div>
        <div class="decoration-circle decoration-circle-4"></div>
        <div class="decoration-circle decoration-circle-5"></div>
    </div>

    <div class="product-details-container animate-in">
        @if (toastMessage) {
            <div class="cart-toast" [class.success]="toastType === 'success'" [class.error]="toastType === 'error'">
                {{ toastMessage }}
            </div>
        }

        @if(product) {
            <button class="back-button" (click)="goBack()" aria-label="Go back">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                <span>Back</span>
            </button>
            <app-product-item
                [product]="product"
                [addToCartDisabled]="isAddToCartDisabled()"
                [showMaxQuantityBanner]="maxQuantityBannerVisible()"
                [showLoginMessage]="!isLoggedIn()"
                (addToCart)="onAddToCart()">
            </app-product-item>

            <div class="product-actions-section">
                <button 
                    class="btn btn-secondary btn-reviews"
                    [disabled]="!isLoggedIn()"
                    (click)="openReviewsPanel()"
                    [title]="!isLoggedIn() ? 'Please log in to view and write reviews' : 'View and write reviews'">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                    <span>Reviews</span>
                </button>
            </div>
        } @else {
            <p>Loading...</p>
        }
    </div>

    @if (productId && reviewsPanelOpen()) {
        <app-reviews-panel
            [productId]="productId"
            [isOpen]="reviewsPanelOpen"
            (closePanel)="closeReviewsPanel()">
        </app-reviews-panel>
    }
</div>
